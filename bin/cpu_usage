#!/bin/bash

P0="_"
P1=▁
P2=▂
P3=▃
P4=▄
P5=▅
P6=▆
P7=▇
P8=█

cpus_usage=$(mpstat 1 1 -P ON | grep ^[0-9].*[[:space:]][0-4][[:space:]] | awk -F ' ' '{print 100-$12 }')

message=""
separator="<span size='5000'> </span>"

for i in $cpus_usage; do
  index=$(echo 8*$i/100 | bc)
  message+="<span foreground='#7cafc2'>$(eval echo \$P$index)</span>$separator"
done

echo ${message%$separator}
